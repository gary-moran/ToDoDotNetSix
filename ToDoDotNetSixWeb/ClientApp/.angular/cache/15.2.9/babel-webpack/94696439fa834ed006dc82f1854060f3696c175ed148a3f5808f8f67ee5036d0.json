{"ast":null,"code":"import { NgbTooltipModule } from '@ng-bootstrap/ng-bootstrap';\nimport { isNullOrUndefined } from 'is-what';\nimport { ErrorsTranslation } from '../../utilities/errors-translation';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ng-bootstrap/ng-bootstrap\";\nconst _c0 = [\"tooltipVar\"];\nexport class ElementValidationMessageComponent {\n  constructor() {\n    this.tooltipMessageText = 'Undefined Error';\n  }\n  ngOnDestroy() {\n    this.statusChange$.unsubscribe();\n  }\n  ngAfterViewInit() {\n    // Determine text to display in tooltip and show tooltip\n    this.updateTooltipText();\n    // setup statusChange$ observable\n    if (this.model) {\n      this.statusChange$ = this.model.statusChanges.subscribe(() => {\n        this.updateTooltipText();\n      });\n    }\n  }\n  /**\r\n   * Update Tooltip Text\r\n   */\n  updateTooltipText() {\n    if (this.model) {\n      if (!isNullOrUndefined(this.key)) {\n        this.tooltipMessageText = this.key;\n      } else if (!isNullOrUndefined(this.message)) {\n        this.tooltipMessageText = this.message;\n      }\n      // if no key or message passed but a model is passed with errors, then extract the errors to determine the messages\n      else if (!isNullOrUndefined(this.model.errors)) {\n        let messageText = \"\";\n        this.tooltipMessageText = \"\";\n        // for each error object\n        for (const property in this.model.errors) {\n          // we will manually set required message\n          const required = property === 'required' && this.model.errors[property];\n          // errors that end with -MSG are our custom error messages, that need to be translated\n          if (property.endsWith(\"-MSG\") || required) {\n            messageText = required ? \"VALIDATION.REQUIRED\" : this.model.errors[property];\n            // errors can include a parameter, which needs to be removed for translation, then added back in\n            const index = messageText.indexOf(\":\");\n            let param = \"\";\n            if (index > -1) {\n              if (!(index + 1 >= messageText.length)) {\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                param = messageText.substring(index + 1);\n              }\n              // translate message\n              messageText = `${ErrorsTranslation.translate(messageText.substr(0, index))}: ${param}`;\n            } else messageText = ErrorsTranslation.translate(messageText);\n            // if necessary, append multiple messages\n            if (this.tooltipMessageText == \"\") this.tooltipMessageText = messageText;else this.tooltipMessageText = `${this.tooltipMessageText}; ${messageText}`;\n          }\n        }\n      }\n      // Close tooltip if already open\n      if (this.tooltip.isOpen()) this.tooltip.close();\n      // Set text to display\n      this.tooltip.ngbTooltip = this.tooltipMessageText;\n      // Open tooltip\n      this.tooltip.open();\n    }\n  }\n}\nElementValidationMessageComponent.ɵfac = function ElementValidationMessageComponent_Factory(t) {\n  return new (t || ElementValidationMessageComponent)();\n};\nElementValidationMessageComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: ElementValidationMessageComponent,\n  selectors: [[\"element-validation-message\"]],\n  viewQuery: function ElementValidationMessageComponent_Query(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵviewQuery(_c0, 7);\n    }\n    if (rf & 2) {\n      let _t;\n      i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.tooltip = _t.first);\n    }\n  },\n  inputs: {\n    key: \"key\",\n    message: \"message\",\n    model: \"model\"\n  },\n  standalone: true,\n  features: [i0.ɵɵStandaloneFeature],\n  decls: 2,\n  vars: 1,\n  consts: [[\"ngbTooltip\", \"\", \"placement\", \"bottom\", \"tooltipClass\", \"my-custom-class\", \"triggers\", \"manual\", 3, \"autoClose\"], [\"tooltipVar\", \"ngbTooltip\"]],\n  template: function ElementValidationMessageComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelement(0, \"div\", 0, 1);\n    }\n    if (rf & 2) {\n      i0.ɵɵproperty(\"autoClose\", false);\n    }\n  },\n  dependencies: [NgbTooltipModule, i1.NgbTooltip],\n  styles: [\".my-custom-class .tooltip-inner {\\n      background-color: red;\\n    }\\n    .my-custom-class .tooltip-arrow::before {\\n      border-bottom-color: red;\\n    }\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hcHAvc2hhcmVkL2NvbXBvbmVudHMvZWxlbWVudC12YWxpZGF0aW9uLW1lc3NhZ2UvZWxlbWVudC12YWxpZGF0aW9uLW1lc3NhZ2UuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO01BQ00scUJBQXFCO0lBQ3ZCO0lBQ0E7TUFDRSx3QkFBd0I7SUFDMUIiLCJzb3VyY2VzQ29udGVudCI6WyIubXktY3VzdG9tLWNsYXNzIC50b29sdGlwLWlubmVyIHtcbiAgICAgIGJhY2tncm91bmQtY29sb3I6IHJlZDtcbiAgICB9XG4gICAgLm15LWN1c3RvbS1jbGFzcyAudG9vbHRpcC1hcnJvdzo6YmVmb3JlIHtcbiAgICAgIGJvcmRlci1ib3R0b20tY29sb3I6IHJlZDtcbiAgICB9Il0sInNvdXJjZVJvb3QiOiIifQ== */\"],\n  encapsulation: 2\n});","map":{"version":3,"mappings":"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","names":["NgbTooltipModule","isNullOrUndefined","ErrorsTranslation","ElementValidationMessageComponent","constructor","ngOnDestroy","statusChange$","unsubscribe","ngAfterViewInit","updateTooltipText","model","statusChanges","subscribe","key","tooltipMessageText","message","errors","messageText","property","required","endsWith","index","indexOf","param","length","substring","translate","substr","tooltip","isOpen","close","ngbTooltip","open","selectors","viewQuery","i0","styles","encapsulation"],"sourceRoot":"","sources":["C:\\Projects\\web\\ToDoDotNetSix\\ToDoDotNetSixWeb\\ClientApp\\src\\app\\shared\\components\\element-validation-message\\element-validation-message.component.ts"],"sourcesContent":["/**************************************************************************\r\n*\r\n*  System:    ToDo (Web)\r\n*  Module:    Client App \\ Shared \\ Components\r\n*  Date:      04-AUG-2023\r\n*  Author:    Gary Moran (GM)\r\n*  Function:  Element Validation Component\r\n*  Notes:\r\n*\r\n*                   : History of Amendments :\r\n*  Date        Name        Brief description                \r\n*  ----------- ----------  ---------------------------------------------\r\n*  04-AUG-2023 GM          Created\r\n************************************************************************/\r\n\r\nimport { AfterViewInit, Component, Input, ViewChild, ViewEncapsulation, OnDestroy } from '@angular/core';\r\nimport { NgbTooltip, NgbTooltipModule } from '@ng-bootstrap/ng-bootstrap';\r\nimport { AbstractControl} from '@angular/forms';\r\nimport { isNullOrUndefined } from 'is-what';\r\nimport { Subscription } from 'rxjs';\r\nimport { ErrorsTranslation } from '../../utilities/errors-translation';\r\n\r\n@Component({\r\n  selector: 'element-validation-message',\r\n  imports: [NgbTooltipModule],\r\n  standalone: true,\r\n  template:\r\n    `<div ngbTooltip placement=\"bottom\" #tooltipVar=\"ngbTooltip\" tooltipClass=\"my-custom-class\" [autoClose]=\"false\" triggers=\"manual\"></div>`,\r\n  encapsulation: ViewEncapsulation.None,\r\n  styles: [\r\n    `.my-custom-class .tooltip-inner {\r\n      background-color: red;\r\n    }\r\n    .my-custom-class .tooltip-arrow::before {\r\n      border-bottom-color: red;\r\n    }`\r\n  ]\r\n})\r\n\r\nexport class ElementValidationMessageComponent implements AfterViewInit, OnDestroy {\r\n\r\n  @Input() key!: string;\r\n  @Input() message!: string;\r\n  @Input() model!: AbstractControl | null;\r\n  @ViewChild('tooltipVar', { static: true }) tooltip!: NgbTooltip;\r\n\r\n  tooltipMessageText: string = 'Undefined Error';\r\n  statusChange$!: Subscription;\r\n\r\n  ngOnDestroy() {\r\n    this.statusChange$.unsubscribe();\r\n  }\r\n\r\n  ngAfterViewInit() {\r\n\r\n    // Determine text to display in tooltip and show tooltip\r\n    this.updateTooltipText();\r\n\r\n    // setup statusChange$ observable\r\n    if (this.model) {\r\n      this.statusChange$ = this.model.statusChanges.subscribe(() => {\r\n        this.updateTooltipText();\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update Tooltip Text\r\n   */\r\n  private updateTooltipText(): void {\r\n\r\n    if (this.model) {\r\n\r\n      if (!isNullOrUndefined(this.key)) {\r\n        this.tooltipMessageText = this.key;\r\n      } else if (!isNullOrUndefined(this.message)) {\r\n        this.tooltipMessageText = this.message;\r\n      }\r\n\r\n      // if no key or message passed but a model is passed with errors, then extract the errors to determine the messages\r\n      else if (!isNullOrUndefined(this.model.errors)) {\r\n\r\n        let messageText: string = \"\";\r\n        this.tooltipMessageText = \"\";\r\n\r\n        // for each error object\r\n        for (const property in this.model.errors) {\r\n\r\n          // we will manually set required message\r\n          const required: boolean = property === 'required' && this.model.errors[property];\r\n\r\n          // errors that end with -MSG are our custom error messages, that need to be translated\r\n          if (property.endsWith(\"-MSG\") || required) {\r\n            messageText = required ? \"VALIDATION.REQUIRED\" : this.model.errors[property] as string;\r\n\r\n            // errors can include a parameter, which needs to be removed for translation, then added back in\r\n            const index: number = messageText.indexOf(\":\");\r\n            let param: string = \"\";\r\n            if (index > -1) {\r\n              if (!(index + 1 >= messageText.length)) {\r\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n                param = messageText.substring(index + 1);\r\n              }\r\n\r\n              // translate message\r\n              messageText = `${ErrorsTranslation.translate(messageText.substr(0, index))}: ${param}`;\r\n            }\r\n\r\n            else\r\n              messageText = ErrorsTranslation.translate(messageText);\r\n\r\n            // if necessary, append multiple messages\r\n            if (this.tooltipMessageText == \"\")\r\n              this.tooltipMessageText = messageText;\r\n            else\r\n              this.tooltipMessageText = `${this.tooltipMessageText}; ${messageText}`;\r\n          }\r\n        }\r\n      }\r\n\r\n      // Close tooltip if already open\r\n      if (this.tooltip.isOpen())\r\n        this.tooltip.close();\r\n\r\n      // Set text to display\r\n      this.tooltip.ngbTooltip = this.tooltipMessageText;\r\n\r\n      // Open tooltip\r\n      this.tooltip.open();\r\n    }\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}